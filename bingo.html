<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ€å¹´æœ«ã‚¸ãƒ£ãƒ³ãƒœ ãƒ“ãƒ³ã‚´å¤§ä¼š ğŸ€</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<style>
body{
  font-family:'Hiragino Kaku Gothic ProN', sans-serif;
  background:linear-gradient(135deg,#fff0f6,#e0f7fa);
  text-align:center;
  padding:20px;
}
h1{color:#e67cb8}
#bingo-card{
  display:grid;
  grid-template-columns:repeat(5,60px);
  gap:6px;
  justify-content:center;
  margin:20px auto;
}
.cell{
  width:60px;height:60px;line-height:60px;
  border:2px solid #f8a4c3;
  border-radius:10px;
  background:#fff;
  font-weight:bold;
}
.cell.marked{
  background:#fff;
  color:#e60073;
}
button{
  padding:10px 16px;
  border:none;
  border-radius:8px;
  background:#f8a4c3;
  color:#fff;
  cursor:pointer;
}
</style>
</head>

<body>

<h1>ğŸ€å¹´æœ«ã‚¸ãƒ£ãƒ³ãƒœ ãƒ“ãƒ³ã‚´å¤§ä¼š ğŸ€</h1>

<div>
  <button onclick="resetGame()">ãƒªã‚»ãƒƒãƒˆ</button>
</div>

<div id="bingo-card"></div>

<div>
  <button onclick="drawNumber()">ç•ªå·ã‚’ã²ã ğŸ²</button>
  <div>æœ€æ–°ç•ªå·ï¼š<span id="last-number">â€“</span></div>
  <div>å‡ºãŸç•ªå·ï¼š<span id="numbers-list">ï¼ˆã¾ã ã‚ã‚Šã¾ã›ã‚“ï¼‰</span></div>
</div>

<script>
/* ===== Firebase ===== */
firebase.initializeApp({
  apiKey: "AIzaSyCVofvlR6N837LqdNxRweTq93Uu6qpgbsI",
  authDomain: "sushi-cd085.firebaseapp.com",
  databaseURL: "https://sushi-cd085-default-rtdb.firebaseio.com",
  projectId: "sushi-cd085"
});
const db = firebase.database();

/* ===== å¤‰æ•° ===== */
const SIZE = 5;
let card = [];
let drawn = [];

const cardEl = document.getElementById("bingo-card");
const lastEl = document.getElementById("last-number");
const listEl = document.getElementById("numbers-list");

/* ===== ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ ===== */
function generateCard(){
  const used = new Set();
  card=[];
  while(card.length<25){
    const n = Math.floor(Math.random()*75)+1;
    if(!used.has(n)){
      used.add(n);
      card.push(n);
    }
  }
  card[12] = "FREE";
}

function renderCard(){
  cardEl.innerHTML="";
  card.forEach(v=>{
    const d=document.createElement("div");
    d.className="cell";
    d.textContent=v;
    if(v==="FREE" || drawn.includes(v)) d.classList.add("marked");
    cardEl.appendChild(d);
  });
}

/* ===== æŠ½é¸ ===== */
function drawNumber(){
  if(drawn.length>=75) return;
  let n;
  do{
    n=Math.floor(Math.random()*75)+1;
  }while(drawn.includes(n));

  db.ref("events/event1/drawnNumbers").set([...drawn,n]);
}

/* ===== åŒæœŸ ===== */
db.ref("events/event1/drawnNumbers").on("value", snap=>{
  drawn = snap.val() || [];
  lastEl.textContent = drawn.at(-1) ?? "â€“";
  listEl.textContent = drawn.length ? drawn.join("ãƒ»") : "ï¼ˆã¾ã ã‚ã‚Šã¾ã›ã‚“ï¼‰";
  renderCard();
});

/* ===== ãƒªã‚»ãƒƒãƒˆ ===== */
function resetGame(){
  if(!confirm("ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) return;
  db.ref("events/event1/drawnNumbers").set([]);
  drawn=[];
  generateCard();
  renderCard();
}

/* ===== åˆæœŸåŒ– ===== */
generateCard();
renderCard();
</script>

</body>
</html>
